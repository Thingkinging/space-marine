<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spaceMarine.mapper.ItemMapper">
	<select id="getList" resultType="com.spaceMarine.vo.ItemVO">
		select distinct * from item
	</select>

	<select id="read" resultType="com.spaceMarine.vo.ItemVO">
		select * from item where IMPA_CD =
		#{IMPA_CD}
	</select>


	<!-- 페이징 처리 -->

	<select id="getListWithPaging"
		resultType="com.spaceMarine.vo.ItemVO">
		SELECT * from item
		<where>
			<if test="keyword != null">
				IMPA_CD like concat('%',#{keyword},'%')
				or ITEM_NM_KO like
				concat('%',#{keyword},'%')
				or DESCRIPTION like
				concat('%',#{keyword},'%')
				or ITEM_NM_EN like
				concat('%',#{keyword},'%')
				or ITEM_NM_SP like
				concat('%',#{keyword},'%')
				or ITEM_NM_JP like
				concat('%',#{keyword},'%')
				or ITEM_NM_CN like
				concat('%',#{keyword},'%')
				or ITEM_NM_RS like
				concat('%',#{keyword},'%')
			</if>
		</where>
		<!-- LIMIT #{pageNum},#{amount} -->
		LIMIT 0, 14
	</select>


	<!-- 전체 데이터 개수 -->
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM item

	</select>

	<select id="big_cd" resultType="com.spaceMarine.vo.ItemVO">
		WITH RECURSIVE cte AS
		(
		SELECT LVL1_CD, LVL2_CD, LVL3_CD, LVL4_CD FROM item
		UNION all
		SELECT a.LVL1_CD, a.LVL2_CD, a.LVL3_CD, a.LVL4_CD FROM item AS a
		INNER JOIN cte AS b
		ON a.LVL1_CD = b.LVL2_CD
		)
		SELECT DISTINCT LVL1_CD FROM cte;
	</select>

	<select id="middle_cd" resultType="com.spaceMarine.vo.ItemVO">
		WITH RECURSIVE cte AS
		(
		SELECT
		LVL1_CD, LVL2_CD, LVL3_CD, LVL4_CD FROM item WHERE LVL1_CD =
		#{LVL1_CD}
		UNION all
		SELECT
		a.LVL1_CD, a.LVL2_CD, a.LVL3_CD, a.LVL4_CD
		FROM item AS a
		INNER JOIN cte AS b
		ON a.LVL1_CD = b.LVL2_CD
		)
		SELECT
		LVL2_CD FROM cte;

	</select>
	<select id="small_cd" resultType="com.spaceMarine.vo.ItemVO">
		WITH RECURSIVE cte AS
		(
		SELECT
		LVL1_CD, LVL2_CD,LVL3_CD, LVL4_CD FROM item WHERE LVL1_CD = #{LVL1_CD}
		AND
		LVL2_CD = #{LVL2_CD}
		UNION all
		SELECT a.LVL1_CD, a.LVL2_CD,a.LVL3_CD,
		a.LVL4_CD
		FROM item AS a
		INNER JOIN cte AS b
		ON a.LVL1_CD = b.LVL2_CD
		)
		SELECT distinct LVL3_CD FROM cte;

	</select>

</mapper>